# Set the server variable
$Server = "MyServer"  # replace with your server name

# Construct default website and app pool names
$DefaultWebsiteName = $Server + "astrazeneca."
$DefaultAppPoolName = $Server + "AppPool"

Import-Module WebAdministration
$checks = @()

# IIS & Services
$checks += [pscustomobject]@{Check="IIS Console"; Status=if((Get-WindowsFeature Web-Mgmt-Console).Installed){"Installed"}else{"Missing"}}
$checks += [pscustomobject]@{Check="WAS Service"; Status=if((Get-Service WAS -ErrorAction SilentlyContinue).Status -eq 'Running'){"Running"}else{"Stopped"}}
$checks += [pscustomobject]@{Check="W3SVC Service"; Status=if((Get-Service W3SVC -ErrorAction SilentlyContinue).Status -eq 'Running'){"Running"}else{"Stopped"}}

# .NET 4.8
$net48 = (Get-ItemProperty "HKLM:\SOFTWARE\Microsoft\NET Framework Setup\NDP\v4\Full" -ErrorAction SilentlyContinue).Release
$checks += [pscustomobject]@{Check=".NET 4.8"; Status=if($net48 -ge 528040){"Installed"}else{"Missing"}}

# IIS Installation Path
$inetsrvPath = (Get-ItemProperty "HKLM:\SOFTWARE\Microsoft\InetStp" -ErrorAction SilentlyContinue).PathOfInstall
$checks += [pscustomobject]@{Check="IIS Path"; Status=if(Test-Path $inetsrvPath){"Exists"}else{"Missing"}; Path=$inetsrvPath}

# Default Website validation
$defaultSite = Get-Website -Name $DefaultWebsiteName -ErrorAction SilentlyContinue
$checks += [pscustomobject]@{
    Check="Default Website"; 
    Status=if($defaultSite){"Present"}else{"Missing"}; 
    Path=if($defaultSite){$defaultSite.physicalPath}else{"N/A"}
}

# IIS Log Path
$logPath = if($defaultSite){$defaultSite.logFile.directory}else{"N/A"}
$checks += [pscustomobject]@{Check="IIS Log Path"; Status=if($logPath -ne "N/A"){"Exists"}else{"N/A"}; Path=$logPath}

# Default App Pool validation
$appPool = Get-Item "IIS:\AppPools\$DefaultAppPoolName" -ErrorAction SilentlyContinue
$checks += [pscustomobject]@{
    Check="Default App Pool"; 
    Status=if($appPool){"Present"}else{"Missing"}; 
    Path=if($appPool){"$DefaultAppPoolName"}else{"N/A"}
}

# QUAL.HTML page accessibility
$pageUrl = "http://localhost/QUAL.HTML"
try{$resp=Invoke-WebRequest $pageUrl -UseBasicParsing -ErrorAction Stop;$pageStatus="Accessible"}catch{$pageStatus="Not Accessible"}
$checks += [pscustomobject]@{Check="QUAL.HTML Page"; Status=$pageStatus; Path=$pageUrl}

# Display table
$checks | Format-Table -AutoSize
